(my["webpackJsonp"]=my["webpackJsonp"]||[]).push([["plugins/scan_code/index/index"],{"7a4b":function(t,i,e){"use strict";var n=function(){var t=this,i=t.$createElement;t._self._c},a=[];e.d(i,"a",function(){return n}),e.d(i,"b",function(){return a})},"92c0":function(t,i,e){"use strict";e.r(i);var n=e("7a4b"),a=e("9812");for(var o in a)"default"!==o&&function(t){e.d(i,t,function(){return a[t]})}(o);e("ebd7");var c=e("2877"),r=Object(c["a"])(a["default"],n["a"],n["b"],!1,null,"5a76d438",null);i["default"]=r.exports},9812:function(t,i,e){"use strict";e.r(i);var n=e("bd4b"),a=e.n(n);for(var o in n)"default"!==o&&function(t){e.d(i,t,function(){return n[t]})}(o);i["default"]=a.a},"9d98":function(t,i,e){},bd4b:function(t,i,e){"use strict";(function(t){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var e={name:"index",components:{},data:function(){return{page_loading:!0,tmp_price:"",edit_status:!0,price_modal:!1,activity:null,remark:"",integral:{user_integral_num:"0"},list:{price:"",pay_price:0,use_integral:0,activity_id:0,coupon_id:0,can_coupon_num:0,integral_explain:[]},clear:!1}},onShow:function(){var t=this,i=t.$store.state.scanCode.userCoupon;if(i?(t.list.coupon_id=i.id,t.calcPrice()):t.list.coupon_id=0,t.clear){console.log("onShow => clear");var e=[!0,!1,"","",{price:"",pay_price:0,use_integral:0,activity_id:0,coupon_id:0,can_coupon_num:0,integral_explain:[]}];t.edit_status=e[0],t.clear=e[1],t.remark=e[2],t.tmp_price=e[3],t.list=e[4]}},onLoad:function(t){var i=this;if(t.price){var e=[!1,t.price];i.edit_status=e[0],i.tmp_price=e[1],i.calcPrice()}i.$showLoading({text:"加载中"}),i.$request({url:i.$api.scan_code_pay.index}).then(function(t){if(i.$hideLoading(),0===t.code){var e=[t.data.activity,t.data.goods,t.data.integral,t.data.setting];i.activity=e[0],i.goods=e[1],i.integral=e[2],i.setting=e[3]}}).catch(function(t){i.$hideLoading()})},methods:{openPriceModel:function(){this.edit_status&&(this.price_modal=!0)},closePriceModel:function(){this.price_modal=!1},setTempInput:function(t){this.tmp_price=t.detail.value},calcPrice:function(){var i=this;i.price_modal=!1,i.$showLoading({text:"加载中"}),i.$request({url:i.$api.scan_code_pay.preview,data:{price:i.tmp_price,coupon_id:i.list.coupon_id,use_integral:i.list.use_integral},method:"POST"}).then(function(e){if(i.$hideLoading(),0===e.code){var n=[e.data,e.data.price];i.list=n[0],i.tmp_price=n[1]}else t.showToast({icon:"none",title:e.msg})}).catch(function(t){i.$hideLoading()})},handleUseIntegral:function(){var t=this,i=t.list;i.use_integral=1==i.use_integral?0:1,t.calcPrice()},bindTextBlur:function(t){this.remark=t.detail.value},getIntegralInfo:function(i){var e="";this.list.integral_explain.map(function(t){e+="消费满"+t.consume_money+"元，",e+="积分最多可抵"+t.integral_deduction+"元",e+="\r\n"}),t.showModal({title:"积分抵扣说明",content:e.trim(),showCancel:!1})},setCoupon:function(i){this.clear=!1,t.navigateTo({url:"/plugins/scan_code/index/coupon?price="+this.list.price+"&coupon_id="+this.list.coupon_id})},submit:function(i){var e=this;e.list.price&&(e.$showLoading({text:"正在提交"}),e.$request({url:e.$api.scan_code_pay.submit,method:"post",data:{price:e.list.price,coupon_id:e.list.coupon_id,use_integral:e.list.use_integral,remark:e.remark}}).then(function(i){e.$hideLoading(),0===i.code?e.$payment.pay(i.data.pay_id).then(function(n){t.showModal({title:"提示",content:"支付成功",showCancel:!1,success:function(){t.navigateTo({url:"/pages/order-submit/pay-result?payment_order_union_id="+i.data.pay_id+"&plugin=scan_code_pay"}),e.clear=!0}})}).catch(function(n){e.$showLoading({text:"取消中"}),e.$request({url:e.$api.scan_code_pay.cancel,data:{pay_id:i.data.pay_id},method:"POST"}).then(function(t){e.$hideLoading()}).catch(function(i){e.$hideLoading(),t.showModal({title:"提示",content:i.msg})})}):t.showModal({title:"提示",content:info.msg})}).catch(function(t){e.$hideLoading()}))}}};i.default=e}).call(this,e("c11b")["default"])},ebd7:function(t,i,e){"use strict";var n=e("9d98"),a=e.n(n);a.a}},[["b695","common/runtime","common/vendor"]]]);