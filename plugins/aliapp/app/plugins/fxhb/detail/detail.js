(my["webpackJsonp"]=my["webpackJsonp"]||[]).push([["plugins/fxhb/detail/detail"],{"153d":function(t,e,i){},4419:function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=a(i("a34a")),r=i("2f62");function a(t){return t&&t.__esModule?t:{default:t}}function o(t,e,i,n,r,a,o){try{var s=t[a](o),u=s.value}catch(c){return void i(c)}s.done?e(u):Promise.resolve(u).then(n,r)}function s(t){return function(){var e=this,i=arguments;return new Promise(function(n,r){var a=t.apply(e,i);function s(t){o(a,n,r,s,u,"next",t)}function u(t){o(a,n,r,s,u,"throw",t)}s(void 0)})}}function u(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function c(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?u(i,!0).forEach(function(e){l(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):u(i).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}function l(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var d=function(){return Promise.all([i.e("common/vendor"),i.e("components/page-component/app-goods-list/app-goods-list")]).then(i.bind(null,"3f73"))},h={name:"detail",components:{appGoodsList:d},computed:c({},(0,r.mapState)({appImg:function(t){return t.mallConfig.plugin.fxhb.app_image}})),data:function(){var t;return{interval_time:t,user_activity_id:0,config:null,goods_list:[],show_share_model:!1,time_str:"00:00:00",is_new:!1,coupon_total_money:0,is_join:0,is_my_hongbao:!1,list:null,min_price:0,reset_time:null,status:-1,totalUser:0,user_num:0,user_num_list:[],user_price:0,again_open:!0,page_url:""}},onLoad:function(t){this.user_activity_id=t.user_activity_id?t.user_activity_id:"",this.loadConfig()},onShareAppMessage:function(){return this.$shareAppMessage({title:this.config.share_title,path:"/plugins/fxhb/detail/detail",params:{user_activity_id:this.user_activity_id},imageUrl:this.config.share_pic_url})},onUnload:function(){clearInterval(this.intervalTime)},methods:{loadConfig:function(){var e=this;t.showLoading({title:"加载中"}),e.$request({url:e.$api.fxhb.index,data:{user_activity_id:e.user_activity_id}}).then(function(i){t.hideLoading(),0===i.code?(e.config=i.data.config,i.data.user_activity_id?(e.user_activity_id=i.data.user_activity_id,e.loadData()):e.user_activity_id?e.detailSubmit():e.openNew()):(t.showToast({icon:"none",title:i.msg}),setTimeout(function(){t.redirectTo({url:"/pages/index/index"})},2e3))}).catch(function(){t.hideLoading()})},openNew:function(){var t=[-1,!0,[]];this.status=t[0],this.is_new=t[1],this.goods_list=t[2]},open:function(){this.again_open&&(this.user_activity_id=0,this.detailSubmit(),this.again_open=!1)},rules:function(){t.navigateTo({url:"/plugins/fxhb/rule/rule?rules="+this.config.remark})},homes:function(){t.navigateTo({url:"/pages/index/index"})},goods:function(){t.redirectTo({url:this.page_url})},detailSubmit:function(){var e=this;t.showLoading({title:"抢红包中",mask:!0}),e.$request({url:e.$api.fxhb.join,method:"post",data:{user_activity_id:e.user_activity_id}}).then(function(i){t.hideLoading(),0===i.code?e.result(i.data.queueId,i.data.token):(e.openNew(),t.showToast({icon:"none",title:i.msg}))}).catch(function(){t.hideLoading()})},loadData:function(){var e=s(n.default.mark(function e(){var i,r,a,o,s,u,c,l,d,h,f,_,p,m,v;return n.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return i=this,t.showLoading({title:"加载中",mask:!0}),e.next=4,this.$request({url:i.$api.fxhb.detail,data:{user_activity_id:i.user_activity_id}});case 4:if(r=e.sent,t.hideLoading(),0===r.code){for(a=r.data,o=a.coupon_total_money,s=a.is_join,u=a.is_my_hongbao,c=a.list,l=a.min_price,d=a.page_url,h=a.reset_time,f=a.status,_=a.totalUser,p=a.user_num,m=a.user_price,this.coupon_total_money=o,this.is_join=s,this.is_my_hongbao=u,this.list=c,this.min_price=l,this.page_url=d,this.reset_time=h,this.totalUser=_,this.status=f,this.user_num=p,this.user_price=m,this.user_num_list=[],v=0;v<this.user_num;v++)this.user_num_list.push(v);i.setTimeStart(),i.getRecommend(),this.again_open=!0}else t.showToast({icon:"none",title:r.msg,duration:2e3,success:function(){t.redirectTo({url:"/pages/index/index"})}});case 7:case"end":return e.stop()}},e,this)}));function i(){return e.apply(this,arguments)}return i}(),setTimeStart:function(){var t=this;clearInterval(this.interval_time);var e=function(){var e=0,i=0,n=0,r=t.reset_time;r--,r>0&&(e=Math.floor(r/3600),i=Math.floor(r/60)-60*e,n=Math.floor(r)-60*e*60-60*i);var a=[r,{hour:e,minute:i,second:n}];t.reset_time=a[0],t.time_list=a[1],t.time_str=(e<10?"0"+e:e)+":"+(i<10?"0"+i:i)+":"+(n<10?"0"+n:n),r<=0&&clearInterval(t.intervalTime)};e(),this.interval_time=setInterval(function(){e()},1e3)},result:function(e,i){t.showLoading({title:"加载中",mask:!0});var n=this;n.$request({url:n.$api.fxhb.join_result,data:{queueId:e,token:i}}).then(function(r){0===r.code?r.data.retry&&1==r.data.retry?setTimeout(function(){n.result(e,i)},1e3):(n.user_activity_id=r.data.user_activity_id,n.loadData(),t.hideLoading(),n.showShareModal()):(t.hideLoading(),n.status=2,t.showToast({icon:"none",title:r.msg,duration:2e3,success:function(){t.redirectTo({url:"/pages/index/index"})}}))})},showShareModal:function(){var t=[!1,!0];this.is_new=t[0],this.show_share_model=t[1]},closeShareModal:function(){var t=[!1];this.show_share_model=t[0]},getRecommend:function(){var e=s(n.default.mark(function e(){var i,r;return n.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return i=this,t.showLoading({title:"加载中",mask:!0}),e.next=4,i.$request({url:i.$api.fxhb.recommend});case 4:r=e.sent,t.hideLoading(),0===r.code&&(i.goods_list=r.data.list);case 7:case"end":return e.stop()}},e,this)}));function i(){return e.apply(this,arguments)}return i}()}};e.default=h}).call(this,i("c11b")["default"])},"7c6b":function(t,e,i){"use strict";var n=i("153d"),r=i.n(n);r.a},b634:function(t,e,i){"use strict";i.r(e);var n=i("4419"),r=i.n(n);for(var a in n)"default"!==a&&function(t){i.d(e,t,function(){return n[t]})}(a);e["default"]=r.a},bf61:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement;t._self._c},r=[];i.d(e,"a",function(){return n}),i.d(e,"b",function(){return r})},f99b:function(t,e,i){"use strict";i.r(e);var n=i("bf61"),r=i("b634");for(var a in r)"default"!==a&&function(t){i.d(e,t,function(){return r[t]})}(a);i("7c6b");var o=i("2877"),s=Object(o["a"])(r["default"],n["a"],n["b"],!1,null,"322c72d8",null);e["default"]=s.exports}},[["d26c","common/runtime","common/vendor"]]]);