# è®¢å•è¯´æ˜

## è®¢å•ä¸­çš„ä»·æ ¼å­—æ®µè¯´æ˜

###æ‰€æœ‰è®¢å•

- total_price: æ‰€æœ‰è®¢å•å®é™…éœ€æ”¯ä»˜çš„é‡‘é¢æ€»å’Œï¼ˆå«è¿è´¹ï¼‰ã€‚

###å•†æˆ·è®¢å•

- total_price: æ‰€æœ‰å•†å“åŠè¿è´¹éœ€æ”¯ä»˜çš„é‡‘é¢æ€»å’Œï¼ˆå•†å“ä¼˜æƒ åï¼‰ã€‚
- total_goods_original_price: æ‰€æœ‰å•†å“çš„é‡‘é¢æ€»å’Œï¼ˆå•†å“ä¼˜æƒ å‰ï¼‰ã€‚
- total_goods_price: æ‰€æœ‰å•†å“çš„é‡‘é¢æ€»å’Œï¼ˆå•†å“ä¼˜æƒ åï¼‰ã€‚
- express_price: è¿è´¹ã€‚

###è®¢å•å†…çš„å•†å“

- total_original_price: å•†å“åŸä»·ï¼ˆä¼˜æƒ å‰ï¼‰ã€‚
- total_price: éœ€æ”¯ä»˜çš„å•†å“æ€»ä»·ï¼ˆä¼˜æƒ åï¼‰ã€‚

## è®¢å•ä»·æ ¼è®¡ç®—è¯´æ˜

```
å•ä¸ªå•†æˆ·è®¢å•é‡‘é¢ç›¸å…³ï¼š
  å•†å“é‡‘é¢ =
     æ•°é‡Ã—å•ä»·/

     ï¼ˆä¼šå‘˜ä»·1ã€ä¼šå‘˜æŠ˜æ‰£2ï¼ŒäºŒé€‰ä¸€ï¼‰

     ä¼˜æƒ åˆ¸ï¼ˆä½¿ç”¨æ¡ä»¶éƒ½æŒ‰åŸä»·åŸºå‡†è®¡ç®—ï¼‰

     ç§¯åˆ†æŠµæ‰£ï¼ˆä½¿ç”¨æ¡ä»¶éƒ½æŒ‰åŸä»·åŸºå‡†è®¡ç®—ï¼Œå®é™…æ‰£é™¤çš„ç§¯åˆ†æŒ‰å®é™…æŠµæ‰£çš„é‡‘é¢è®¡ç®—ï¼‰ã€‚

  ä¼šå‘˜æŠ˜æ‰£/
  ä¼šå‘˜ä»·/
  ç§¯åˆ†æŠµæ‰£/nä¸ªç§¯åˆ†æŠµæ‰£n/må…ƒ
  ä¼˜æƒ åˆ¸/æ»¡å‡|æŠ˜æ‰£ï¼Œä¸€ä¸ªè®¢å•åªèƒ½ç”¨ä¸€ä¸ªä¼˜æƒ åˆ¸ï¼Œ


  è¿è´¹/
    /äºŒè€…æ»¡è¶³ä¸€ä¸ªæ¡ä»¶å³å¯åŒ…é‚®
    å•å“æ»¡ä»¶åŒ…é‚®/è´­ä¹°æ»¡nä»¶å•†å“åŒ…é‚®ã€‚
    å•å“æ»¡é¢åŒ…é‚®/è´­ä¹°æ»¡é‡‘é¢nåŒ…é‚®ã€‚
    å¦‚æœè®¾ç½®äº†å•å“åŒ…é‚®è§„åˆ™ï¼Œé‚£å•å“çš„åŒ…é‚®å¿…é¡»æ»¡è¶³å•å“çš„è§„åˆ™è¯¥å•å“æ‰å¯ä»¥åŒ…é‚®ã€‚

    åŒ…é‚®è®¡ç®—çš„é‡‘é¢ä»¥å•†å“åŸä»·è®¡ç®—

    å¤šä¸ªå•å“è®¾ç½®äº†å•å“åŒ…é‚®/
      /å•å“è¿è´¹ä¸å…¨å±€æ— å…³
      /ä¸è®¾ç½®å•å“åŒ…é‚®çš„æŒ‰å…¨å±€çš„åŒ…é‚®è§„åˆ™è®¡ç®—ï¼ˆæŒ‰æ•´ä¸ªè®¢å•é‡‘é¢è®¡ç®—ï¼‰
    éƒ½æ²¡è®¾ç½®å•å“åŒ…é‚®/
      /æŒ‰å…¨å±€åŒ…é‚®è§„åˆ™è®¡ç®—
      
    å¤šä¸ªå•†å“ä¸€èµ·ä¸‹å•ï¼Œæœ‰å•å“è®¾ç½®äº†åŒ…é‚®è§„åˆ™
      /å…¨å±€åŒ…é‚®è§„åˆ™æ˜¯å¦è¿˜éœ€è¦å°†è¿™ä¸ªå•ç‹¬è®¾ç½®äº†åŒ…é‚®çš„å•å“ï¼ˆé‡‘é¢ã€ä»¶æ•°ï¼‰åŠ å…¥è®¡ç®—ï¼Ÿ åŠ å…¥ã€‚
      /å¤šä¸ªå•å“åŒ…é‚®æ²¡è¾¾åˆ°åŒ…é‚®æ¡ä»¶ï¼Œè¿è´¹æ˜¯å¦æ˜¯å åŠ èµ·æ¥ï¼Ÿ å åŠ ã€‚
      /å•å“åŒ…é‚®çš„è®¡ç®—é‡‘é¢æ˜¯å•å“çš„é‡‘é¢Ã—å•å“æ•°é‡ï¼ˆä¸åŒè§„æ ¼çš„åŒä¸€å•†å“ä¸€èµ·ç®—ï¼‰ã€‚   


    è¿è´¹æŒ‰ä»¶è®¡ç®—/ä¸åŒåœ°åŒºä¸åŒè¿è´¹ã€‚
    è¿è´¹æŒ‰é‡é‡è®¡ç®—/ä¸åŒåœ°åŒºä¸åŒè¿è´¹ã€‚


---------
æ’ä»¶ç›¸å…³ä¼˜æƒ /
  ç§’æ€ä»·æ ¼/
  å›¢è´­ä»·æ ¼/
  å›¢é•¿ä»·æ ¼/

-----------
ä¸‹å•é™åˆ¶/
  åŒºåŸŸé™åˆ¶/åªå…è®¸æŒ‡å®šçš„åŒºåŸŸä¸‹å•ï¼Œé’ˆå¯¹å•†åŸè‡ªèº«ã€‚

  èµ·é€é™åˆ¶/æŒ‡å®šåŒºåŸŸ å•ä¸ªå•†æˆ·è®¢å•æ»¡è¶³nå…ƒæ‰å¯ä¸‹å•ï¼Œå¤šä¸ªå•†æˆ·ä¸€èµ·ä¸‹å•æœ‰ä¸æ»¡è¶³æ¡ä»¶çš„ä¸å…è®¸ä¸‹å•ã€‚
  èµ·é€é‡‘é¢æŒ‰è®¢å•åŸä»·è®¡ç®—ï¼ˆä¸å«è¿è´¹ï¼‰ï¼›


å¤šä¸ªè®¢å•ä¸€èµ·æäº¤åªè¦æœ‰ä¸€ä¸ªä¸èƒ½ä¸‹å•åˆ™å¤šä¸ªè®¢å•éƒ½ä¸èƒ½ä¸‹å•ã€‚

```

## è®¢å•æµç¨‹å¼€æ”¾

**è®¢å•æµç¨‹å¼€æ”¾å¯å‚è€ƒå°ç¨‹åºç«¯ç¤ºä¾‹/pages/test-order-submit/test-order-submit**

$form = new OrderSubmitForm();

### è®¢å•æ ‡è¯†

- $form->setSign(string); // è®¾ç½®è®¢å•çš„æ ‡è¯†ï¼Œä¸»è¦ç”¨äºåŒºåˆ†æ’ä»¶

### ä¸‹å•åŠŸèƒ½å¼€å…³

- $form->setEnableMemberPrice(bool); // æ˜¯å¦å¼€å¯ä¼šå‘˜ä»·ä¼šå‘˜æŠ˜æ‰£åŠŸèƒ½

- $form->setEnableCoupon(bool); // æ˜¯å¦å¼€å¯ä¼˜æƒ åˆ¸åŠŸèƒ½

- $form->setEnableIntegral(bool); // æ˜¯å¦å¼€å¯ç§¯åˆ†åŠŸèƒ½

- $form->setEnableOrderForm(bool); // æ˜¯å¦å¼€å¯è‡ªå®šä¹‰è¡¨å•åŠŸèƒ½

### è‹¥æ’ä»¶éœ€è¦å®šåˆ¶è®¢å•æ•°æ®åˆ™éœ€è¦ç»§æ‰¿OrderSubmitFormå¹¶é‡å†™è‡ªå·±éœ€è¦ä¿®æ”¹çš„æ–¹æ³•ï¼Œä¸‹é¢åˆ—ä¸¾æ”¯æŒé‡å†™çš„æ–¹æ³•:

0. **è®¢å•å•†å“ä¿¡æ¯**

   - æ–¹æ³•å®šä¹‰:
    ```
    OrderSubmitForm::getGoodsListData($goodsList);
    ```
    
   - å‚æ•°ç¤ºä¾‹:
   ```
   // è¡¨å•æäº¤form_data['list'][n]['goods_list']çš„æ•°æ®
   [
       0 => [
           'id' => 9
           'goods_attr_id' => 349
           'num' => 1
           'cart_id' => 0
       ]
   ]
   ```
   
   - è¿”å›ç¤ºä¾‹:
    ```
    [
        0 => [
            'id' => 9
            'name' => 'ã€ç»„åˆè¿è´¹æµ‹è¯•ã€‘é‡é‡'
            'num' => 1
            'forehead_integral' => 0
            'forehead_integral_type' => 1
            'accumulative' => 0
            'pieces' => '0'
            'forehead' => '0'
            'freight_id' => 8
            'unit_price' => '5.00'
            'total_original_price' => '5.00'
            'total_price' => '5.00'
            'goods_attr' => [
                'id' => '349'
                'goods_id' => 9
                'sign_id' => '3:5'
                'stock' => '9997'
                'price' => '40'
                'no' => ''
                'weight' => 0
                'pic_url' => ''
                'share_commission_first' => '50.00'
                'share_commission_second' => '30.00'
                'share_commission_third' => '10.00'
                'is_delete' => 0
            ]
            'attr_list' => [
                0 => [
                    'attr_group_name' => 'é¢œè‰²'
                    'attr_group_id' => 1
                    'attr_id' => 3
                    'attr_name' => 'é»‘è‰²'
                ]
                1 => [
                    'attr_group_name' => 'å°ºç '
                    'attr_group_id' => 2
                    'attr_id' => 5
                    'attr_name' => 'L'
                ]
            ]
            'discounts' => []
            'member_discount' => '0.00'
        ]
    ]
    ```

0. **å•†æˆ·åˆ—è¡¨ä¿¡æ¯**

   - æ–¹æ³•å®šä¹‰:
    ```
    OrderSubmitForm::getMchListData($formMchList);
    ```
    
   - å‚æ•°ç¤ºä¾‹:
   ```
   // è¡¨å•æäº¤form_data['list']çš„æ•°æ®
   [
       0 => [
           'mch_id' => 0
           'goods_list' => [
               0 => [
                   'id' => 9
                   'goods_attr_id' => 349
                   'num' => 1
                   'cart_id' => 0
               ]
           ]
           'use_integral' => 0
           'user_coupon_id' => 0
       ]
   ]
   ```
   
   - è¿”å›ç¤ºä¾‹
   ```
   [
       0 => [
           'mch' => [
               'id' => 0
               'name' => 'ç¦¾åŒ å•†åŸğŸ'
           ]
           'goods_list' => [], // getGoodsListDataè¿”å›çš„ç»“æœ
           'form_data' => [
               'mch_id' => 0
               'goods_list' => [
                   0 => [
                       'id' => 9
                       'goods_attr_id' => 349
                       'num' => 1
                       'cart_id' => 0
                   ]
               ]
               'use_integral' => 0
               'user_coupon_id' => 0
           ]
       ]
   ]
   ```
   
0. **å•†å“åº“å­˜æ›´æ–°**

   - æ–¹æ³•å®šä¹‰:
    ```
    OrderSubmitForm::subGoodsNum($goodsAttr, $subNum, $goodsItem);
    ```
    
   - å‚æ•°ç¤ºä¾‹:
   ```
   // $goodsAttr: å½“å‰å•†å“çš„app\models\GoodsAttrå¯¹è±¡
   
   // $subNum: æ‰£é™¤çš„å•†å“æ•°é‡
   
   // $goodsItem: OrderSubmitForm::getGoodsListData() è¿”å›çš„åˆ—è¡¨çš„ä¸€é¡¹
   ```
   
   - è¿”å›ç¤ºä¾‹
   ```
   // åº“å­˜æ›´æ–°æˆåŠŸè¿”å›trueï¼Œåº“å­˜ä¸è¶³æˆ–æ›´æ–°å¤±è´¥æŠ›å‡ºå¼‚å¸¸ã€‚
   ```

0. **å°ç¨‹åºç«¯**

   å°ç¨‹åºç«¯`/pages/order-submit/order-submit`é¡µé¢ä¹Ÿæ”¯æŒä¸€äº›å‚æ•°ä»¥å®ç°è®¢å•çš„å®šåˆ¶åŒ–:
   
   - preview_url: è¡¨å•é¢„è§ˆçš„æ¥å£ï¼ˆéœ€urlEncodeï¼‰ã€‚
   
   - submit_url: è¡¨å•æäº¤çš„æ¥å£ï¼ˆéœ€urlEncodeï¼‰ã€‚
   